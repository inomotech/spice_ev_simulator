.. _simulating_with_spiceev:

~~~~~~~~~~~~~~~~~~~~~~~
Simulating with SpiceEV
~~~~~~~~~~~~~~~~~~~~~~~

.. _command_line_options:

Command line options
====================

You can set parameters through the command line or from a configuration file. If unsure, you can type `python script.py --help` to get detailed information.

Where the default is an Array (`[]`), the option can be set multiple times.

generate.py
-----------
Generate scenarios as JSON files for vehicle charging modelling.

+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
|**command line options**       | **short form**   | **configuration file**     | **description**                                                                                                  |  **default**                                | **example**                                                             |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| (positional)                  |                  | mode                       | Input type. Possible values: statistics, simbev, csv                                                             | statistics                                  |./generate.py statistics -o scenario.json                                |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --output                      | -o               | output                     | Output file name. Required.                                                                                      | (must be set)                               |./generate.py -o scenario.json                                           |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --battery                     | -b               | battery                    | Add battery with specified capacity in kWh and C-rate                                                            | []                                          |-b 100 0.5                                                               |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --cs-power-min                |                  | cs_power_min               | Set minimal power of charging station in kW                                                                      | 0.1 * cs_power                              |--cs-power-min 3.7                                                       |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --discharge-limit             |                  | discharge_limit            | Minimum SoC to discharge to during v2g [0-1]                                                                     | 0.5                                         |--discharge-limit 0                                                      |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --gc-power                    |                  | gc_power                   | Set possible power at grid connection point in kW                                                                | 100                                         |--gc-power 150                                                           |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-ext-load-csv        |                  | include_ext_load_csv       | Include CSV for external load. Path is relative to output file.                                                  | None                                        |--include-ext-load-csv load.csv                                          |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-ext-load-csv-option | -eo              | include_ext_load_csv-option| Set additional arguments to external load. See below.                                                            | []                                          |-eo column energy                                                        |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include_feed_in_csv         |                  | include_feed_in_csv        | Include CSV for energy feed-in, e.g., local PV. Path is relative to output file.                                 |  None                                       |--include-feed-in-csv feed_in.csv                                        |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-feed-in-csv-option  | -fo              | include_feed_in_csv_option | Set additional arguments to feed-in load. See below.                                                             | []                                          |-fo step_duration 900                                                    |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-price-csv           |                  | include-price-csv          | Include CSV for energy price. Path is relative to output file.                                                   | None                                        |--include-price-csv price.csv                                            |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-price-csv-option    | -po              | include_price_csv_option   | Set additional arguments to price signals. See below.                                                            | []                                          |-po column price                                                         |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --interval                    |                  | interval                   | Set number of minutes for each timestep (Î”t)                                                                     | 15                                          |--interval 1                                                             |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --min-soc                     |                  | min-soc                    | Set minimum desired SoC (0%-100%) for each charging process                                                      | 80                                          |--min-soc 50                                                             |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --pv-power                    |                  | pv_power                   | Set nominal power for local photovoltaic power plant in kWp                                                      | 0                                           |--pv-power 100                                                           |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --seed                        |                  | seed                       | Set random seed                                                                                                  | None                                        |--seed 1                                                                 |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --vehicle-types               |                  | vehicle_types              | location of vehicle type definitions                                                                             | None                                        |--vehicle-types examples/vehicle_types.json                              |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --verbose                     | -v               | verbose                    | Set verbosity level. 0: only errors and important warnings, 1: additional warnings and info                      | 0                                           |-v 1                                                                     |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --voltage-level               | -vl              | voltage_level              | Set voltage level for cost calculation (possible voltage levels: HV, HV/MV, MV, MV/LV, LV)                       | None                                        |-vl MV                                                                   |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --config                      |                  | (no effect)                | Use configuration file to set arguments. Overrides command line arguments.                                       | None                                        |--config examples/generate.cfg                                           |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+

Special options for mode *statistics*:

+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
|**command line options**       | **short form**   | **configuration file**     | **description**                                                                                                  |  **default**                                | **example**                                                             |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --buffer                      |                  | buffer                     | Set buffer on top of needed SoC for next trip                                                                    | 0.1                                         |--buffer 0                                                               |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --days                        |                  | days                       | Set duration of scenario as number of days                                                                       | 30                                          |--days 7                                                                 |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --holidays                    |                  | holidays                   | Specify dates in ISO format of no driving                                                                        | []                                          |--holidays [2023-01-01]                                                  |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --start-time                  |                  | start_time                 | Provide start time of simulation in ISO format, precision is 1 second                                            | 2023-01-01T01:00:00+02:00                   |--start-time 2023-01-01T01:00:00+02:00                                   |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --vehicles                    |                  | vehicles                   | Set number of vehicles for a vehicle type                                                                        | ( [] , continues with 1 golf and 1 sprinter)|--vehicles 100 sprinter                                                  |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+

Special options for mode *simbev*:

+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
|**command line options**       | **short form**   | **configuration file**     | **description**                                                                                                  |  **default**                                | **example**                                                             |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --simbev                      |                  | simbev                     | Directory with SimBEV files. Required.                                                                           | (must be set)                               |--simbev /path/to/simbev/output/                                         |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --ignore-simbev-soc           |                  | ignore_simbev_soc          | Don't use SoC columns from SimBEV files                                                                          | false                                       |--ignore-simbev-soc                                                      |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --min-soc-threshold           |                  | min_soc_threshold          | SoC below this threshold will trigger a warning                                                                  | 0.05                                        |--min-soc-threshold 0                                                    |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --region                      |                  | region                     | Set name of region                                                                                               | None                                        |--region region_1                                                        |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+

Special options for mode *csv*:

+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
|**command line options**       | **short form**   | **configuration file**     | **description**                                                                                                  |  **default**                                | **example**                                                             |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --input-file                  |                  | input_file                 | Input file name (rotations_example_table.csv). Required.                                                         | (must be set)                               |--input-file rotations_example_table.csv                                 |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --days                        |                  | days                       | Set duration of scenario as number of days                                                                       | 30                                          |--days 7                                                                 |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --export-vehicle-id-csv       |                  | export_vehicle_id_csv      | Export csv after assigning vehicle_id, path relative to output scenario.json                                     | None                                        |--export-vehicle-id-csv vehicle_id.csv                                   |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --min-soc-threshold           |                  | min_soc_threshold          | SoC below this threshold will trigger a warning                                                                  | 0.05                                        |--min-soc-threshold 0                                                    |
+-------------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+

generate_schedule.py
--------------------
Compute flexibility and schedule for a given scenario. Automatically includes schedule in scenario file.

+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
|**command line options** |**short form** | **configuration file** | **description**                                                             |  **default**              | **example**                          |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
| (positional)            |               | scenario               | Scenario JSON file name                                                     | (must be set)             |./generate_schedule.py example.json   |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
| --input                 |               | input                  | Timeseries of grid situation with columns 'curtailment' and 'residual load' | (must be set)             |--input grid_situation.csv            |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
| --output                | -o            | output                 | Resulting schedule file name                                                | \<scenario>_schedule.csv  |-o schedule.csv                       |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
| --individual            | -i            | individual             | Schedule based on individual vehicles instead of vehicle park               | False                     |-i                                    |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
| --core-standing-time    |               | core_standing_time     | Time and full days during which the fleet is guaranteed to be available     | None                      |see config example file               |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
| --visual                | -v            | visual                 | Plot flexibility and schedule                                               | False                     |-v                                    |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
| --config                |               | (no effect)            | Use configuration file to set arguments. Overrides command line arguments.  | None                      |--config examples/generate.cfg        |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+


CSV file options
----------------
Options to be set when using csv files.

+------------------+----------------------------------------+-----------------------+
|**key**           | **description**                        | **example value**     |
+------------------+----------------------------------------+-----------------------+
|step_duration_s   | Interval between rows in seconds       | 3600                  |
+------------------+----------------------------------------+-----------------------+
|grid_connector_id | ID of grid connector                   | GC1                   |
+------------------+----------------------------------------+-----------------------+
|column            | Column name with values of interest    | energy                |
+------------------+----------------------------------------+-----------------------+


simulate.py
-----------
Simulate different charging strategies for a given scenario.

+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
|**command line options** | **short form**   | **configuration file** | **description**                                                                                                      |  **default**  | **example**                     |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| (positional)            |                  | input                  | scenario json file                                                                                                   | (must be set) | ./simulate.py example.json      |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --strategy              | -s               | strategy               | charging strategy                                                                                                    | greedy        |--strategy balanced              |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --visual                | -v               | visual                 | Show plots of the results.                                                                                           | None          |./simulate.py example.json -v    |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --eta                   |                  | eta                    | * Show estimated remaining time instead of progress bar.                                                             | False         |./simulate.py example.json --eta |
|                         |                  |                        | * Not recommended for fast computations.                                                                             |               |                                 |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --margin                | -m               | margin                 |* Add margin for desired SOC [0.0 - 1.0]                                                                              | 0.05          |--margin 1                       |
|                         |                  |                        |* margin=0.05 means the simulation will not abort if vehicles reach                                                   |               |                                 |
|                         |                  |                        |* at least 95%% of the desired SOC before leaving.                                                                    |               |                                 |
|                         |                  |                        |* margin=1 -> the simulation continues with every positive SOC value                                                  |               |                                 |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --strategy-option       | -so              | strategy_option        | * set charging strategy options.                                                                                     |               |-so CONCURRENCY 0.5              |
|                         |                  |                        | * For configuration file, see simulate.cfg in examples directory.                                                    |               |                                 |
|                         |                  |                        | * For supported options, refer to the :ref:`strategy options <strategy_options>`.                                    |               |                                 |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --cost-calc             | -cc              | cost_calc              | Calculate electricity costs.                                                                                         | False         |                                 |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --cost-parameters-file  | -cp              | cost_parameters_file   | Get cost parameters from json file                                                                                   | None          |                                 |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --output                | -o               | output                 | Generate output file.                                                                                                | None          | --output output.csv             |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --save-timeseries       |                  | save_timeseries        | Write timeseries to file.                                                                                            | None          | --output timeseries.csv         |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --save-results          |                  | save_results           | Write general information to file.                                                                                   | None          | --save-results results.json     |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --save-soc              |                  | save_soc               | Write SoCs of vehicles to file.                                                                                      | None          | --save-soc soc.csv              |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --testing               |                  | testing                | Stores testing results.                                                                                              | False         |                                 |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --config                |                  | (no effect)            | Use configuration file to set arguments. Overrides command line arguments.                                           |  None         | --config examples/simulate.cfg  |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+

All charging strategies support the `EPS` option, which defines the difference under which two floating point numbers are considered equal. In other words, the value chosen for `EPS` determines the precision of the simulation. The smaller it is the more precise the calculations are. The downside to this is an increase running time. For some numerical procedures the algorithm might get stuck completely if `EPS` is too small. The default is 10^-5.

Every strategy also supports the strategy options `ALLOW_NEGATIVE_SOC` and `RESET_NEGATIVE_SOC`. They control how to proceed should the SoC of a vehicle become negative. Both are False by default, which means the simulation will abort in such a case. If `ALLOW_NEGATIVE_SOC` is set, the simulation continues instead of aborting. If `RESET_NEGATIVE_SOC` is set, the SoC of the vehicle is set to zero. These options are helpful when simulating plug-in hybrids.
NOTE: For SoC<0 batteries are charged/discharge with the amount of power specified on the charging/discharging curve at SoC=0. Make sure that Power(SoC=0) > 0, in case you want use the strategy option `ALLOW_NEGATIVE_SOC`.
NOTE: By default, discharging below SoC=0 only applies to vehicles while driving. To discharge below SoC=0 for stationary batteries or V2G, you need to set the target soc parameter of the battery.unload function accordingly.

.. _strategy_options:

Strategy options
----------------
**Greedy**

    +-------------------+---------------+---------------------------------------------------------+
    |**Strategy option**| **default**   |              **explanation**                            |
    +-------------------+---------------+---------------------------------------------------------+
    |   CONCURRENCY     |     1.0       | Reduce maximum available power at each charging station.|
    |                   |               |                                                         |
    |                   |               | A value of 0.5 means only half the power is available.  |
    +-------------------+---------------+---------------------------------------------------------+
    |   PRICE_THRESHOLD |    0.001      | A price below this is considered cheap. Unit: â‚¬ / 1 kWh |
    +-------------------+---------------+---------------------------------------------------------+

**Balanced**

    +-------------------+---------------+---------------------------------------------------------+
    |**Strategy option**| **default**   |              **explanation**                            |
    +-------------------+---------------+---------------------------------------------------------+
    |   ITERATIONS      |     12        | Minimum depth of binary search to find charging power   |
    +-------------------+---------------+---------------------------------------------------------+
    |   PRICE_THRESHOLD |    0.001      | A price below this is considered cheap. Unit: â‚¬ / 1 kWh |
    +-------------------+---------------+---------------------------------------------------------+

**GreedyMarket**

    +-------------------+---------------+---------------------------------------------------------+
    |**Strategy option**| **default**   |              **explanation**                            |
    +-------------------+---------------+---------------------------------------------------------+
    |   CONCURRENCY     |     1.0       | Reduce maximum available power at each charging station.|
    |                   |               |                                                         |
    |                   |               | A value of 0.5 means only half the power is available.  |
    +-------------------+---------------+---------------------------------------------------------+
    |   HORIZON         |      24       | number of hours to look ahead                           |
    +-------------------+---------------+---------------------------------------------------------+
    |   PRICE_THRESHOLD |    0.001      | A price below this is considered cheap. Unit: â‚¬ / 1 kWh |
    +-------------------+---------------+---------------------------------------------------------+
    |   DISCHARGE_LIMIT |      0        | V2G: maximum depth of discharge [0-1]                   |
    +-------------------+---------------+---------------------------------------------------------+


**BalancedMarket**

    +-------------------+---------------+---------------------------------------------------------+
    |**Strategy option**| **default**   |              **explanation**                            |
    +-------------------+---------------+---------------------------------------------------------+
    | CONCURRENCY       |     1.0       | Reduce maximum available power at each charging station.|
    |                   |               |                                                         |
    |                   |               | A value of 0.5 means only half the power is available.  |
    +-------------------+---------------+---------------------------------------------------------+
    | HORIZON           |      24       | number of hours to look ahead                           |
    +-------------------+---------------+---------------------------------------------------------+
    | PRICE_THRESHOLD   |    0.001      | A price below this is considered cheap. Unit: â‚¬ / 1 kWh |
    +-------------------+---------------+---------------------------------------------------------+
    | DISCHARGE_LIMIT   |      0        | V2G: maximum depth of discharge [0-1]                   |
    +-------------------+---------------+---------------------------------------------------------+
    | V2G_POWER_FACTOR  |      1        | Fraction of max battery power used for discharge        |
    |                   |               | process [0-1]                                           |
    +-------------------+---------------+---------------------------------------------------------+

**Schedule**

    +-------------------+---------------+---------------------------------------------------------+
    |**Strategy option**| **default**   |              **explanation**                            |
    +-------------------+---------------+---------------------------------------------------------+
    | LOAD_STRAT        | "collective"  | choose between individual and collective                |
    +-------------------+---------------+---------------------------------------------------------+

**PeakLoadWindow**

    +-------------------+---------------+---------------------------------------------------------+
    |**Strategy option**| **default**   |              **explanation**                            |
    +-------------------+---------------+---------------------------------------------------------+
    | LOAD_STRAT        |   "needy"     | charging strategy, see above                            |
    +-------------------+---------------+---------------------------------------------------------+

**FlexWindow**

    +-------------------+---------------+---------------------------------------------------------+
    |**Strategy option**| **default**   |              **explanation**                            |
    +-------------------+---------------+---------------------------------------------------------+
    |   CONCURRENCY     |     1.0       | Reduce maximum available power at each charging station.|
    |                   |               |                                                         |
    |                   |               | A value of 0.5 means only half the power is available.  |
    +-------------------+---------------+---------------------------------------------------------+
    |   HORIZON         |      24       | number of hours to look ahead                           |
    +-------------------+---------------+---------------------------------------------------------+
    |   PRICE_THRESHOLD |    0.001      | A price below this is considered cheap. Unit: â‚¬ / 1 kWh |
    +-------------------+---------------+---------------------------------------------------------+
    |   DISCHARGE_LIMIT |      0        | V2G: maximum depth of discharge [0-1]                   |
    +-------------------+---------------+---------------------------------------------------------+
    |  V2G_POWER_FACTOR |      1        | Fraction of max battery power used for discharge        |
    |                   |               | process [0-1]                                           |
    +-------------------+---------------+---------------------------------------------------------+
    |   LOAD_STRAT      |   "balanced   | Sub-strategies for behaviour within charging windows    |
    |                   |               |                                                         |
    |                   |               | (see description above for options and explanations)    |
    +-------------------+---------------+---------------------------------------------------------+

**Distributed**

    +----------------------+---------------+---------------------------------------------------------------------+
    |**Strategy option**   | **default**   |              **explanation**                                        |
    +----------------------+---------------+---------------------------------------------------------------------+
    |   ALLOW_NEGATIVE_SOC |   False       | simulation does not abort if SoC becomes negative                   |
    +----------------------+---------------+---------------------------------------------------------------------+
    |   C-HORIZON          |      3        | loading time in min reserved for vehicle if number of cs is limited |
    +----------------------+---------------+---------------------------------------------------------------------+
    |   DISCHARGE_LIMIT    |      0        | V2G: maximum depth of discharge [0-1]                               |
    +----------------------+---------------+---------------------------------------------------------------------+
    |  V2G_POWER_FACTOR    |      1        | Fraction of max battery power used for discharge                    |
    |                      |               | process [0-1]                                                       |
    +----------------------+---------------+---------------------------------------------------------------------+
    |   PRICE_THRESHOLD    |    0.001      | A price below this is considered cheap. Unit: â‚¬ / 1 kWh             |
    +----------------------+---------------+---------------------------------------------------------------------+

.. _file_formats:

Input and output file formats
=============================

SpiceEV uses human-readable files for inputs, scenario definitions, configuration files and outputs. Not every type of input is part of the repository, as some data is classified and/or should be created by the user according to need.

generate.py / generate_from_simbev.py
-------------------------------------

Inputs
......

**External load**

File type: csv

Needs one column with the drawn power in kW (can have more columns, but only one is relevant). The file is read line-by-line, with events starting at start_time and updating every interval (configurable).

**Feed-in**

File type: csv

Needs one column with the power generation kW (can have more columns, but only one is relevant). The file is read line-by-line, with events starting at start_time and updating every interval (configurable).

**Energy price**

File type: csv

Needs one column with the energy price in â‚¬/kWh (can have more columns, but only one is relevant). The file is read line-by-line, with events starting at start_time and updating every interval (configurable).

**Configuration**

File type: text

Refer to generate.cfg in examples folder.

Output
......
File type: json

To be used in simulate.py. Defines general info (start_time, interval, n_intervals), constants (vehicle types, vehicles, grid connectors, charging stations, batteries) and events (external loads, feed-in, grid operator signals and vehicle events).

generate_from_csv.py
--------------------
Inputs
......
**Trips_schedule**

File type: csv

Each row in csv file represents one trip. The following columns are needed:
departure time (datetime), arrival time (datetime), vehicle_type (str), soc (numeric) / delta_soc (numeric) / distance (numeric)
optional columns: vehicle_id (str)

**Configuration**

File type: text

Refer to generate_from_csv.cfg in examples folder or the generate_from_csv_template.csv

Output
......
File type: json

Scenario.json

Output
......
File type: csv

To be used in generate-scripts. Columns date, time and price [ct/kWh].


generate_schedule.py
--------------------

Inputs
......
** Grid situation **

File type: csv

Needed columns: curtailment (numeric), residual load (numeric)

** Scenario **

File type: json

Is created by generate scripts.

Output
......
File type: csv

To be used in generate-scripts. Columns timestamp, schedule [kW], charge (0 or 1).

simulate.py
-----------

Inputs
......
**Scenario (required)**

File type: json

Is created by generate scripts.

Output (optional)
.................

File type: csv

All power values are in kW.

+-------------------------------------+---------------------------------------------------------------------------+
| **Column**                          | **Description**                                                           |
+-------------------------------------+---------------------------------------------------------------------------+
| timestep 	                      | simulation timestep, starting at 0                                        |
+-------------------------------------+---------------------------------------------------------------------------+
| time 	                              | datetime of timestep, isoformat                                           |
+-------------------------------------+---------------------------------------------------------------------------+
| grid power	                      | power drawn from grid                                                     |
+-------------------------------------+---------------------------------------------------------------------------+
| ext. load 	                      | sum of external loads, e.g. building power (omitted if not present)       |
+-------------------------------------+---------------------------------------------------------------------------+
| feed-in    	                      | sum of renewable energy sources feed-in power (omitted if not present)    |
+-------------------------------------+---------------------------------------------------------------------------+
| flex min and max 	              | minimum and maximum flexibility per timestep                              |
+-------------------------------------+---------------------------------------------------------------------------+
| sum CS power                        | total of power drawn by charging stations                                 |
+-------------------------------------+---------------------------------------------------------------------------+
| sum for each SimBEV use-case        | SimBEV only                                                               |
+-------------------------------------+---------------------------------------------------------------------------+
| # occupied CS                       |	number of charging stations with a vehicle connected to it                |
+-------------------------------------+---------------------------------------------------------------------------+
| # occupied for each SimBEV use-cases|	SimBEV only                                                               |
+-------------------------------------+---------------------------------------------------------------------------+
| CS name                             |	power at each charging station                                            |
+-------------------------------------+---------------------------------------------------------------------------+
