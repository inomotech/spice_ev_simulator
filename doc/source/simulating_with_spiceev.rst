.. _simulating_with_spiceev:

~~~~~~~~~~~~~~~~~~~~~~~
Simulating with SpiceEV
~~~~~~~~~~~~~~~~~~~~~~~

.. _command_line_options:
Command Line Options
====================

You can set parameters through the command line or from a configuration file. If unsure, you can type `python script.py --help` to get detailed information.

Where the default is an Array (`[]`), the option can be set multiple times.

simulate.py
-----------

Simulate different charging strategies for a given scenario.

+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
|**command line options** | **short form**   | **configuration file** | **description**                                                                                                      |  **default**  | **example**                     |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| (positional)            |                  | input                  | scenario json file                                                                                                   | (must be set) | ./simulate.py example.json      |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --strategy              | -s               |strategy                | charging strategy                                                                                                    | greedy        |--strategy balanced              |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --visual                | -v               | visual                 | Show plots of the results.                                                                                           | None          |./simulate.py example.json -v    |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --eta                   |                  | eta                    | * Show estimated remaining time instead of progress bar.                                                             | False         |./simulate.py example.json --eta |
|                         |                  |                        | * Not recommended for fast computations.                                                                             |               |                                 |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --margin                | -m               | margin                 |* Add margin for desired SOC [0.0 - 1.0]                                                                              | 0.05          |--margin 1                       |
|                         |                  |                        |* margin=0.05 means the simulation will not abort if vehicles reach                                                   |               |                                 |
|                         |                  |                        |* at least 95%% of the desired SOC before leaving.                                                                    |               |                                 |
|                         |                  |                        |* margin=1 -> the simulation continues with every positive SOC value                                                  |               |                                 |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --strategy-option       | -so              | strategy_option        | * set charging strategy options.                                                                                     |  []           |-so CONCURRENCY 0.5              |
|                         |                  |                        | * For configuration file, see simulate.cfg in examples directory.                                                    |               |                                 |
|                         |                  |                        | * For supported options, refer to the [strategy page](Charging-strategies).                                          |               |                                 |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --output                | -o               | output                 | Generate output file.                                                                                                |        None   |         --output output.csv     |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+
| --config                |                  |(no effect)             | * Use configuration file to set arguments.                                                                           |  None         | --config examples/simulate.cfg  |
|                         |                  |                        | * Overrides command line arguments.                                                                                  |               |                                 |
+-------------------------+------------------+------------------------+----------------------------------------------------------------------------------------------------------------------+---------------+---------------------------------+

generate.py
-----------
Generate scenarios as JSON files for vehicle charging modelling.


+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
|**command line options**     | **short form**   | **configuration file**     | **description**                                                                                                  |  **default**                                | **example**                                                             |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| (positional)                |                  | output                     | output file name                                                                                                 | (must be set)                               |./generate.py scenario.json                                              |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --cars                      |                  | cars                       | Set number of cars for a vehicle type.                                                                           | ( [] , continues with 2 golf and 3 sprinter)| --cars 100 sprinter                                                     |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --v2g                       |                  | v2g                        | Are vehicles capable of vehicle-to-grid?                                                                         | False                                       | --v2g, v2g = true                                                       |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --days                      |                  | days                       | Set duration of scenario as number of days.                                                                      | 30                                          | --days 7                                                                |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --interval                  |                  | interval                   | Set number of minutes for each timestep (Δt).                                                                    | 15                                          | --interval 1                                                            |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --min-soc                   |                  | min-soc                    | Set minimum desired SoC (0%-100%) for each charging process.                                                     | 80                                          | --min-soc 50                                                            |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --no-drive-days             |                  | no_drive_days              | Provide weekday of vehicles not driving (Monday = 0, Sunday = 6).                                                | [6]                                         | --no-drive-days 5 6                                                     |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
|                             |                  | holidays                   | Specify dates in ISO format of no driving.                                                                       | []                                          | holidays = ["2018-01-01"]                                               |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --discharge-limit           |                  |                            | Minimum SoC to discharge to during v2g. [0-1]                                                                    | 0.5                                         | --discharge-limit 0                                                     |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
|                             |                  | gc_power                   | Set possible power at grid connection point in kW.                                                               | 530                                         | gc_power = 530                                                          |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --battery                   | -b               | battery                    | * Add battery with specified capacity in kWh and C-rate                                                          | []                                          |* Fixed capacity of 1kW and C-rate of 2:                                 |
|                             |                  |                            | * (-1 for variable capacity, second argument is fixed power)).                                                   |                                             |* -b 1000 2<br>Variable capacity with maximum power of 50 kWh: -b -1 50  |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-ext-load-csv      |                  | include_ext_load_csv       | Include CSV for external load. Path is relative to output file.                                                  | None                                        |--include-ext-load-csv load.csv                                          |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-ext-csv-option    | -eo              | include-ext-csv-option     | include_ext_csv_option | Set additional arguments to external load. See below.                                   | []                                          |-eo column energy                                                        |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include_feed_in_csv       |                  | include_feed_in_csv        | Include CSV for energy feed-in, e.g., local PV. Path is relative to output file.                                 |  None                                       |--include-feed-in-csv feed_in.csv                                        |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-feed-in-csv-option| -fo              | include-feed-in-csv-option | Set additional arguments to feed-in load. See below.                                                             | []                                          |-fo step_duration 900                                                    |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-price-csv         |                  | include-price-csv          | Include CSV for energy price. Path is relative to output file.                                                   | None                                        |--include-price-csv price.csv                                            |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-price-csv-option  | -po              | include_price_csv_option   | Set additional arguments to price signals. See below.                                                            | []                                          |-po column price                                                         |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --config                    |                  | (no effect)                | Use configuration file to set arguments. Overrides command line arguments.                                       | None                                        |--config examples/generate.cfg                                           |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+


generate_from_simbev.py
-----------------------

Generate scenarios as JSON files for vehicle charging modelling from vehicle time series (e.g., SimBEV output).

+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
|**command line options**     | **short form**   | **configuration file**     | **description**                                                                                                  |  **default**                                | **example**                                                             |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| (positional)                |                  | output                     | output file name                                                                                                 | (must be set)                               |generate_from_simbev.py scenario.json                                    |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --simbev                    |                  | simbev                     | Set directory with SimBEV files.                                                                                 | (must be set)                               |--simbev examples/simbev/                                                |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --interval                  |                  | interval                   | Set number of minutes for each timestep (Δt).                                                                    | 80                                          |--min-soc 50                                                             |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --price-seed                |                  | price_seed                 | Set seed when generating random market prices. Negative values for fixed price in cents/kWh.                     | (don't set if you want different prices     |Fixed at 10ct/kWh: --price-seed -10                                      |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --min-soc                   |                  | min_soc                    | Set minimum desired SoC (0%-100%) for each charging process.                                                     | 80                                          |--min-soc 50                                                             |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --min-soc-threshold         |                  | min_soc_threshold          | SoC below this threshold trigger a warning.                                                                      | 0.05                                        |--min-soc-threshold 0                                                    |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --ignore-simbev-soc         |                  | ignore_simbev_soc          | Don't use SoC from SimBEV files directly, but compute required SoC for each trip.                                | False                                       |ignore_simbev_soc = true                                                 |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --verbose                   | -v               | verbose                    | Set verbosity level. Use this multiple times for more output. Default: only errors, 1: warnings, 2: debug        | 0                                           |verbose = 2                                                              |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-ext-load-csv      |                  | include_ext_load_csv       | Include CSV for external load. Path is relative to output file.                                                  | None                                        |--include-ext-load-csv load.csv                                          |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-ext-csv-option    | -eo              | include-ext-csv-option     | include_ext_csv_option | Set additional arguments to external load. See below.                                   | []                                          |-eo column energy                                                        |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include_feed_in_csv       |                  | include_feed_in_csv        | Include CSV for energy feed-in, e.g., local PV. Path is relative to output file.                                 |  None                                       |--include-feed-in-csv feed_in.csv                                        |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-feed-in-csv-option| -fo              | include-feed-in-csv-option | Set additional arguments to feed-in load. See below.                                                             | []                                          |-fo step_duration 900                                                    |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-price-csv         |                  | include-price-csv          | Include CSV for energy price. Path is relative to output file.                                                   | None                                        |--include-price-csv price.csv                                            |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --include-price-csv-option  | -po              | include_price_csv_option   | Set additional arguments to price signals. See below.                                                            | []                                          |-po column price                                                         |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+
| --config                    |                  | (no effect)                | Use configuration file to set arguments. Overrides command line arguments.                                       | None                                        |--config examples/generate.cfg                                           |
+-----------------------------+------------------+----------------------------+------------------------------------------------------------------------------------------------------------------+---------------------------------------------+-------------------------------------------------------------------------+



generate_energy_price.py
------------------------

Generate energy price as CSV. These files can be included when generating scenario JSON files.

+-------------------------+---------------+------------------------+---------------------------------------------+------------------------------------------------------------------+--------------------------------------+
|**command line options** |**short form** | **configuration file** | **description**                             |  **default**                                                     | **example**                          |
+-------------------------+---------------+------------------------+---------------------------------------------+------------------------------------------------------------------+--------------------------------------+
| (positional)            |               | output                 | output file name                            | (must be set)                                                    |./generate_energy_price.py price.csv  |
+-------------------------+---------------+------------------------+---------------------------------------------+------------------------------------------------------------------+--------------------------------------+
| --start                 |               | start                  | First start time in isoformat.              | 2021-01-04T00:00:00+01:00                                        |--start "2021-01-01T00:00:00+01:00"   |
+-------------------------+---------------+------------------------+---------------------------------------------+------------------------------------------------------------------+--------------------------------------+
| --interval              |               | interval               | Set number of hours for each timestep (Δt). | 1                                                                |--interval 6                          |
+-------------------------+---------------+------------------------+---------------------------------------------+------------------------------------------------------------------+--------------------------------------+
| --n-intervals           | -n            | n_intervals            | Number of timesteps.                        | 168                                                              |--n-intervals 744                     |
+-------------------------+---------------+------------------------+---------------------------------------------+------------------------------------------------------------------+--------------------------------------+
| --price-seed            |               | price_seed             | Random seed for energy market prices.       | (don't set if you want different prices each time)               |--price-seed 0                        |
+-------------------------+---------------+------------------------+---------------------------------------------+------------------------------------------------------------------+--------------------------------------+
|                         |               |                        | min_avg_price                               | Only from config: set minimum average daily price                | 2.7                                  |
+-------------------------+---------------+------------------------+---------------------------------------------+------------------------------------------------------------------+--------------------------------------+
|                         |               |                        | max_avg_price                               | Only from config: set maximum average daily price                | 4.9                                  |
+-------------------------+---------------+------------------------+---------------------------------------------+------------------------------------------------------------------+--------------------------------------+
|                         |               |                        | std_avg_price                               | Only from config: set standard deviation around average price    | 1.5                                  |
+-------------------------+---------------+------------------------+---------------------------------------------+------------------------------------------------------------------+--------------------------------------+
| --config                |               | (no effect)            | * Use configuration file to set arguments.  | None                                                             |--config examples/generate.cfg        |
|                         |               |                        | * Overrides command line arguments.         |                                                                  |                                      |
+-------------------------+---------------+------------------------+---------------------------------------------+------------------------------------------------------------------+--------------------------------------+

generate_schedule.py
--------------------
Compute flexibility and schedule for a given scenario. Automatically includes schedule in scenario file.

+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
|**command line options** |**short form** | **configuration file** | **description**                                                             |  **default**              | **example**                          |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
| (positional)            |               | scenario               | Scenario JSON file name                                                     | (must be set)             |./generate_schedule.py example.json   |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
| --input                 |               | input                  | Timeseries of grid situation with columns 'curtailment' and 'residual load'.| (must be set)             |input = grid_situation.csv            |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
| --output                |               | output                 | Resulting schedule file name.                                               | \<scenario>_schedule.csv  | output = schedule.csv                |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
| --max-load-range        |               | max_load_range         | Fraction below maximum load where charging is prohibited.                   | 0.1                       |--max-load-range 0                    |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
| --visual                | -v            | visual                 | Plot flexibility and schedule.                                              | False                     |visual = true                         |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+
| --config                |               | (no effect)            | * Use configuration file to set arguments.                                  | None                      |--config examples/generate.cfg        |
|                         |               |                        | * Overrides command line arguments.                                         |                           |                                      |
+-------------------------+---------------+------------------------+-----------------------------------------------------------------------------+---------------------------+--------------------------------------+


CSV file options
----------------
+------------------+----------------------------------------+---------------------------------------------------------------------+
|**key**           | **description**                        | **example value**                                                   |
+------------------+----------------------------------------+---------------------------------------------------------------------+
|start_time        | Timestamp of first entry in isoformat. | (Should be the same as your scenario. When in doubt, don't touch it)|
+------------------+----------------------------------------+---------------------------------------------------------------------+
|step_duration_s   | Interval between rows in seconds.      | 3600                                                                |
+------------------+----------------------------------------+---------------------------------------------------------------------+
|grid_connector_id | ID of grid connector.                  | GC1                                                                 |
+------------------+----------------------------------------+---------------------------------------------------------------------+
|column            | Column name with values of interest.   | energy                                                              |
+------------------+----------------------------------------+---------------------------------------------------------------------+

.. _file_formats:
Input and output file formats
=============================

SpiceEV uses human-readable files for inputs, scenario definitions, configuration files and outputs. Not every type of input is part of the repository, as some data is classified and/or should be created by the user according to need.

generate.py / generate_from_simbev.py
-------------------------------------

Inputs
......

**External load**

File type: CSV

Needs one column with the drawn energy in kWh (can have more columns, but only one is relevant). The file is read line-by-line, with events starting at start_time and updating every interval (configurable).

**Feed-in**

File type: CSV

Needs one column with the energy produced in kWh (can have more columns, but only one is relevant). The file is read line-by-line, with events starting at start_time and updating every interval (configurable).

**Energy price**

File type: CSV

Needs one column with the energy price in ct/kWh (can have more columns, but only one is relevant). The file is read line-by-line, with events starting at start_time and updating every interval (configurable). Can be created with generate_energy_price.py.

**Configuration**

File type: text

Refer to generate.cfg and generate_from_simbev.cfg in examples folder.

Output
......
File type: JSON

To be used in simulate.py. Defines general info (start_time, interval, n_intervals), constants (vehicle types, vehicles, grid connectors, charging stations, batteries) and events (external loads, feed-in, grid operator signals and vehicle events).

generate_from_csv.py
--------------------
Inputs
......
**Trips_schedule**

File type: CSV

Each row in csv file represents one trip. The following columns are needed:

departure time (datetime), arrival time (datetime), vehicle_type (str), soc (numeric) / delta_soc (numeric) / distance (numeric)
optional columns: vehicle_id (str)

**Configuration**

File type: text

Refer to generate_from_csv.cfg in examples folder or the generate_from_csv_template.csv

Output
......
File type: JSON

Scenario JSON

generate_energy_price.py
------------------------

Inputs
......

**Configuration**

File type: text

Refer to price.cfg in examples folder.

Output
......
File type: CSV

To be used in generate-scripts. Columns date, time and price [ct/kWh].


generate_schedule.py
--------------------

Inputs
......
** Grid operator schedule**

File type: csv

Needed columns: curtailment (numeric), residual load (numeric)

**Configuration**

File type: text

Refer to price.cfg in examples folder.

Output
......
File type: CSV

To be used in generate-scripts. Columns timestamp, schedule [kW], charge (0 or 1).

simulate.py
-----------

Inputs
......
**Szenario (required)**

File type: JSON

Is created by generate.py or generate_from_simbev.py.

**Configuration**

File type: text

Refer to simulate.cfg in examples folder.

Output (optional)
.................

File type: CSV

All power values are in kWh.

+-------------------------------------+---------------------------------------------------------------------------+
| **Column**                          | **Description**                                                           |
+-------------------------------------+---------------------------------------------------------------------------+
| timestep 	                      | simulation timestep, starting at 0                                        |
+-------------------------------------+---------------------------------------------------------------------------+
| time 	                              | datetime of timestep, isoformat                                           |
+-------------------------------------+---------------------------------------------------------------------------+
| grid power	                      | power drawn from grid                                                     |
+-------------------------------------+---------------------------------------------------------------------------+
| ext. loads	                      | sum of external loads, e.g. building power (omitted if not present)       |
+-------------------------------------+---------------------------------------------------------------------------+
| feed-in 	                      | sum of renewable energy sources feed-in power (omitted if not present)    |
+-------------------------------------+---------------------------------------------------------------------------+
| surplus 	                      | unused power from feed-in (omitted if no feed-in present)                 |
+-------------------------------------+---------------------------------------------------------------------------+
| sum CS power                        | total of power drawn by charging stations                                 |
+-------------------------------------+---------------------------------------------------------------------------+
| sum for each SimBEV use-case        | SimBEV only                                                               |
+-------------------------------------+---------------------------------------------------------------------------+
| # occupied CS                       |	number of charging stations with a car connected to it                    |
+-------------------------------------+---------------------------------------------------------------------------+
| #occupied for each SimBEV use-cases |	SimBEV only                                                               |
+-------------------------------------+---------------------------------------------------------------------------+
| CS name                             |	power at each charging station                                            |
+-------------------------------------+---------------------------------------------------------------------------+