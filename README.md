# SpiceEV - Simulation Program for Individual Charging Events of Electric Vehicles

**A tool to generate scenarios of electric-vehicle fleets and simulate different charging strategies.**

[![Build Status](https://github.com/rl-institut/spice_ev/actions/workflows/pythonpackage.yaml/badge.svg?branch=dev)](https://github.com/BESTenergytrade/smbs/actions/workflows/pythonpackage.yaml) [![Documentation Status](https://readthedocs.org/projects/spice-ev/badge/?version=latest)](https://spice-ev.readthedocs.io/en/latest/?badge=latest)

# Introduction

SpiceEV is a program to simulate different charging strategies for a defined set of vehicles and corresponding trips to and from charging stations. The output shows load profiles of the vehicle battery, the corresponding charging station, the grid connector as well as the electricity price and, if applicable, the stationary batteries. Each vehicle is by default connected to a separate charging station. All charging stations of one location can be connected to one grid connector with a defined maximum power. Some charging strategies only allow for one grid connector, please check [Charging strategies](https://spice-ev.readthedocs.io/en/latest/charging_strategies_incentives.html#charging-strategies) for more information.

The input of SpiceEV is given by a `scenario.json` file. The `scenario.json` contains information about the vehicles and their specific attributes (e.g. battery capacity, charging curve, etc.) as well as their trips from and to a specific charging station (so called vehicle events). Further, the charging stations attributes, such as its maximum power, the attached grid connector and the according electricity pricing are defined. Depending on the scenario, a certain foresight can be applied for grid operator signals. If applicable, stationary batteries at the grid connectors with according capacities and c_rates can be defined. Fixed load profiles or local generation time series attached to a grid connector can be imported from CSV files. The input `scenario.json` file can be generated by one of the generate scripts. See [Generate](https://spice-ev.readthedocs.io/en/latest/code.html#generate) for further details.

# Documentation

Full documentation can be found [here](https://spice-ev.readthedocs.io/en/latest/index.html)

# Installation

Just clone this repository. This tool just has an optional dependency on
Matplotlib. Everything else uses the Python (>= 3.6) standard library.

To install `spice_ev` as a package run
```sh
pip install -e .
```

## Run Examples

In order to run a simulation with `simulate.py` a scenario has to be generated first using `generate.py`.

Show all command line options:

```sh
./generate.py -h
./simulate.py -h
```

### Quick Start
 Generate a scenario and store it in a JSON file:

```sh
./generate.py --output example.json
```

Run a simulation of this scenario using the `greedy` charging strategy and show
plots of the results:

```sh
./simulate.py example.json --strategy greedy --visual
```

### Using Configuration Files
There are also example configuration files in the example folder. The required input/output must still be specified manually:

```sh
./generate.py --config examples/configs/generate.cfg
./simulate.py --config examples/configs/simulate.cfg
```

### Generating Scenarios

Generate a 7-day scenario with 10 vehicles of different types and 15 minute timesteps:

```sh
./generate.py --days 7 --vehicles 6 golf --vehicles 4 sprinter --interval 15 -o example.json
```

Include a fixed load in scenario:
```sh
./generate.py --include-fixed-load-csv fixed_load.csv -o example.json
```
Please note that included file paths are relative to the scenario file location. Consider this directory structure:

```sh
├── scenarios
│   ├── price
│   │   ├── price.csv
│   ├── my_scenario
│   │   ├── fixed_load.csv
│   │   ├── example.json
```
The fixed_load.csv file is in the same directory as the example.json, hence no relative path is specified.

To include the price and fixed load timeseries:
```sh
./generate.py --include-price-csv ../price/price.csv --include-fixed-load-csv fixed_load.csv -o example.json
```

### Adding a Schedule to a Scenario

Calculate and include schedule:
```sh
./generate_schedule.py --scenario example.json --input data/timeseries/NSM_1.csv --output data/schedules/NSM_1.csv
```

### Integrating SimBEV

This tools supports scenarios generated by the [SimBEV](https://github.com/rl-institut/simbev) tool. Convert SimBEV output files to a SpiceEV scenario: 
```sh
generate.py simbev --simbev /path/to/simbev/output/ --output example.json
```

# License

SpiceEV is licensed under the MIT License as described in the file [LICENSE](https://github.com/rl-institut/spice_ev/blob/dev/LICENSE)
